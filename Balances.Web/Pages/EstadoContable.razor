@page "/EstadoContable/{balid?}"
@using Balances.DTO;
@using Balances.Model;
@using Balances.Utilities;
@using Balances.Web.Services.Contracts;
@using Balances.Web.Services.Implementation;
@using System.Globalization;
@using System.Text.RegularExpressions;
@using System.Reflection;
@using Blazorise.Extensions;
@using Microsoft.AspNetCore.Http;

@inject IEstadoContableClientService estadoContableService;
@inject NavigationManager NavigationManager
@inject IBalanceClientService balanceService
@inject ISessionClientService sesionService
@inject Blazored.SessionStorage.ISessionStorageService sessionStorage
@inject Blazored.LocalStorage.ILocalStorageService LocalStorage



    <Navegacion Entidad="@($"{TipoEntidad}")" PaginaActiva="EstadoContable" TramiteIniciado = "true"  balid="@balid"></Navegacion>

    <!---------------------------------------------------------------->
    <div class="container mt-4">
        <h2 class="text-center">Estado Contable</h2>
         <div class="row">
            <div class="col">
           
                    <!-- Período -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title d-flex justify-content-center">Período</h5>
                            <div class="form-group">
                                <RadzenFormField Text="Tipo de balance" Style="width:100%">
                                    <RadzenTextBox @bind-Value="@estadoContableDto.tipoBalance" Change="insertEECC"> </RadzenTextBox>
                                </RadzenFormField>

                                <small id="tipoBalanceError" class="text-danger">@tipoBalanceError</small>
                            </div>

                            <div class="form-group">
                           
                                <RadzenStack>
                                    <RadzenLabel Text="Fecha de inicio" Component="DatePickerTimeOnlyType" Style="width:100%"  />
                                <RadzenDatePicker @bind-Value="@(estadoContableDto.fechaInicio)" DateFormat="dd/MM/yyyy" Name="DatePickerTimeOnlyType" Change="insertEECC" Placeholder="dd/MM/yyyy"></RadzenDatePicker>
                                </RadzenStack>
                               
                                <small id="tipoBalanceError" class="text-danger">@fechaInicioError</small>
                            </div>
                   
                            <div class="form-group">
                            <RadzenStack>
                                <RadzenLabel Text="Fecha de cierre" Component="DatePickerTimeOnlyType" Style="width:100%"  />
                                <RadzenDatePicker @bind-Value="@(estadoContableDto.fechaEstado)" DateFormat="dd/MM/yyyy" Name="DatePickerTimeOnlyType" Change="insertEECC" Placeholder="dd/MM/yyyy"></RadzenDatePicker>
                             </RadzenStack>
                            
                            <small id="tipoBalanceError" class="text-danger">@fechaEstadoError</small>

                        </div>
                        </div>
                    </div>

                    <!-- Aprobado por -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title d-flex justify-content-center">Aprobado por</h5>
                                <div class="form-group">
                                <RadzenStack>
                                <RadzenLabel Text="Fecha de Acta de Reunión de Autoridades" Component="DatePickerTimeOnlyType" Style="width:100%"  />
                                <RadzenDatePicker @bind-Value="@(estadoContableDto.fechaReunionDirectorio)" DateFormat="dd/MM/yyyy" Name="DatePickerTimeOnlyType" Placeholder="dd/MM/yyyy" Change="insertEECC"></RadzenDatePicker>
                                </RadzenStack>                            
                                <small id="tipoBalanceError" class="text-danger">@fechaReunionDirectorioError</small>

                            </div>
                        
                            <div class="form-group">
                                <RadzenStack>
                                <RadzenLabel Text="Fecha de Acta de Reunión de Socios" Component="DatePickerTimeOnlyType" Style="width:100%"  />
                                <RadzenDatePicker @bind-Value="@(estadoContableDto.fechaAsamblea)" DateFormat="dd/MM/yyyy" Name="DatePickerTimeOnlyType" Change="insertEECC" Placeholder="dd/MM/yyyy"></RadzenDatePicker>
                                </RadzenStack>
                                <small id="tipoBalanceError" class="text-danger">@fechaAsambleaError</small>
                            </div>
                        </div>
                    </div>

                    <!-- Rubros del Balance -->
                    <div class="card mb-4">
                        <div class="card-body">
                        <h5 class="card-title d-flex justify-content-center">Rubros del Balance</h5>

                            <div class="row">
                            <!--Columna 1-->
                                <div class="col">
                                    <div class="form-group">
                                        <label for="activoCorriente">Caja Y Bancos</label>
                                        <div class="input-group">
                                        <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.cajaYBancos InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                                    </div>
                                    <small id="tipoBalanceError" class="text-danger">@cajaYBancosError</small>

                                    </div>

                                    <div class="form-group">
                                        <label for="activoCorriente">Inversiones</label>
                                        <div class="input-group">
                                        <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.inversionesActivoCorriente InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                                        </div>
                                        <small id="tipoBalanceError" class="text-danger">@inversionesError</small>
                                    </div>

                                    <div class="form-group">
                                        <label for="inversionesActivoCorriente">Bienes de Cambios</label>
                                        <div class="input-group">
                                            <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.bienesDeCambio InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})"  Change="insertEECC" Style="width:100%" />
                                        </div>
                                    <small id="tipoBalanceError" class="text-danger">@bienesDeCambioError</small>

                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="inversionesActivoCorriente">Activo Corriente Restante</label>
                                        <div class="input-group">
                                        <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.activoCorrienteRestante InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />

                                        </div>
                                        <small id="tipoBalanceError" class="text-danger">@activoCorrienteRestanteError</small>

                                    </div>

                                    <div class="form-group">
                                        <label for="inversionesActivoCorriente">Total Activo Corriente</label>
                                        <div class="input-group">
                                        <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.activoCorriente InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC"  Style="width:100%" Disabled />
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="inversionesActivoCorriente">Bienes de Uso</label>
                                        <div class="input-group">
                                         <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.bienesDeUso InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                                     </div>
                                    <small id="tipoBalanceError" class="text-danger">@bienesDeUsoError</small>

                                    </div>

                                    <div class="form-group">
                                        <label for="inversionesActivoCorriente">Propiedades de Inversión</label>
                                        <div class="input-group">
                                         <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.propiedadesDeInversion InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                                        </div>
                                        <small id="tipoBalanceError" class="text-danger">@propiedadesDeInversionError</small>

                                    </div>

                                    <div class="form-group">
                                        <label for="inversionesActivoCorriente">Activo No Corriente Restante</label>
                                        <div class="input-group">
                                         <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.activoNoCorrienteRestante InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />

                                        </div>
                                        <small id="tipoBalanceError" class="text-danger">@activoNoCorrienteRestanteError</small>
                                    </div>

                                    <div class="form-group">
                                        <label for="inversionesActivoCorriente">Total Activo No Corriente</label>
                                        <div class="input-group">
                                         <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.activoNoCorriente InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" Disabled />

                                        </div>
                                    </div>



                                    <div class="form-group">
                                        <label for="inversionesActivoCorriente">Total Activo</label>
                                        <div class="input-group">
                                         <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.totalActivo InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" Disabled />

                                        </div>
                                    </div>


                                    <div class="form-group">
                                        <label for="inversionesActivoCorriente">Deudas del Pasivo Corriente</label>
                                        <div class="input-group">
                                         <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.deudorPasivoCorriente InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                                        </div>
                                        <small id="tipoBalanceError" class="text-danger">@deudasPasivoCorrienteError</small>

                                    </div>


                                    <div class="form-group">
                                        <label for="inversionesActivoCorriente">Deudas del Pasivo No Corriente</label>
                                        <div class="input-group">
                                         <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.deudorPasivoNoCorriente InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />

                                        </div>
                                        <small id="tipoBalanceError" class="text-danger">@deudasPasivoNoCorrienteError</small>
                                    </div>



                                    <div class="form-group">
                                        <label for="inversionesActivoCorriente">Total Pasivo</label>
                                        <div class="input-group">
                                         <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.totalPasivo InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" Disabled />
                                        </div>
                                    </div>


                                    <div class="form-group">
                                        <label for="inversionesActivoCorriente">Patrimonio Neto</label>
                                        <div class="input-group">
                                         <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.patrimonioNeto InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" Disabled />
                                        </div>

                                    </div>

                                    @if (statusPatrimonioNeto)
                                    {
                                        <div class="alert alert-danger" role="alert">
                                            No coinciden el Patrimonio Neto de Activo y Pasivo con 
                                            el Detalle del Patrimonio Neto
                                        </div>
                                    }
                                </div>

                        </div>
                    </div>
                </div>
            </div>
            <!-- Rubros del Patrimonio Neto -->
            <div class="col">
                <div class="card mb-4">
                    <div class="card-body">

                        <h5 class="card-title d-flex justify-content-center">Rubros del Patrimonio Neto</h5>
                        <!-- Repite esta estructura para otros campos -->


                            <div class="form-group">
                                <label for="inversionesActivoCorriente">Capital Suscripto</label>
                                <div class="input-group">
                                <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.capitalSuscripto InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                                </div>
                                <small id="tipoBalanceError" class="text-danger">@capitalSuscriptoError</small>
                            </div>

                            <div class="form-group">
                                <label for="inversionesActivoCorriente">Ajuste de Capital</label>
                                <div class="input-group">
                                <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.ajusteCapital InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                                </div>
                                <small id="tipoBalanceError" class="text-danger">@ajusteCapitalError</small>
                            </div>


                            <div class="form-group">
                                <label for="inversionesActivoCorriente">Aportes Irrevocables</label>
                                <div class="input-group">
                                <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.aportesIrrevocables InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                                </div>
                                <small id="tipoBalanceError" class="text-danger">@aportesIrrevocablesError</small>

                            </div>


                            <div class="form-group">
                                <label for="inversionesActivoCorriente">Prima Emisión</label>
                                <div class="input-group">
                                <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.primaEmision InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                                </div>
                                <small id="tipoBalanceError" class="text-danger">@primaEmisionError</small>

                            </div>



                            <div class="form-group">
                                <label for="inversionesActivoCorriente">Ganancias Reservadas</label>
                                <div class="input-group">
                                <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.gananciasReservadas InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                                </div>
                                <small id="tipoBalanceError" class="text-danger">@gananciasReservadasError</small>

                            </div>


                            <div class="form-group">
                                <label for="inversionesActivoCorriente">Pérdidas Acumuladas</label>
                                <div class="input-group">
                                <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.perdidasAcumuladas InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                                </div>
                                <small id="tipoBalanceError" class="text-danger">@perdidasAcumuladasError</small>

                            </div>



                            <div class="form-group">
                                <label for="inversionesActivoCorriente">Ganancias / Pérdidas del Ejercicio</label>
                                <div class="input-group">
                                <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.gananciasPerdidasEjercicio InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                                </div>
                                <small id="tipoBalanceError" class="text-danger">@gananciasPerdidasEjercicioError</small>

                            </div>


                            <div class="form-group">
                                <label for="inversionesActivoCorriente">Reserva Legal</label>
                                <div class="input-group">
                                <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@estadoContableDto.reservaLegal InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                               </div>
                               <small id="tipoBalanceError" class="text-danger">@reservaLegalError</small>

                            </div>     
                        
                    </div>

                </div>
                <!--Otros Rubros PN -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="form-group">
                            <h5 class="card-title d-flex justify-content-center">
                                Otros Rubros del Patrimonio Neto
                            </h5>
                            <RadzenFormField Text="Denominación" Style="width:100%">
                                <RadzenTextBox @bind-Value="@denominacionDto"  id="txtAddress" />
                            </RadzenFormField>
                            <small id="tipoBalanceError" class="text-danger">@denominacionError</small>

                        </div>
                        <div class="form-group">
                            <label for="inversionesActivoCorriente">Pasivo No Corriente</label>
                            <div class="input-group">
                                <div class="input-group">
                                    <RadzenNumeric TValue="decimal" Format="c" Culture=@argentinianCulture @bind-Value=@importeDto InputAttributes="@(new Dictionary<string,object>(){ { "aria-label", "enter value" }})" Change="insertEECC" Style="width:100%" />
                                </div>
                            </div>
                            <small id="tipoBalanceError" class="text-danger">@pasivoNoCorrienteError</small>
                        </div>
                        <RadzenButton ButtonStyle="ButtonStyle.Primary" Click="@insertRubro">Agregar</RadzenButton>
                        
                    </div>
                </div>

                <RadzenGrid Data="@estadoContableDto.otrosRubros.AsEnumerable()" TItem="RubroPatrimonioNetoDto">
                    <Columns>
                        <RadzenGridColumn TItem="RubroPatrimonioNetoDto" Property="denominacion" Title="Denominación" />
                        <RadzenGridColumn TItem="RubroPatrimonioNetoDto" Property="importe" Title="Importe" Format="{0.00}" Type="decimal" />
                        <RadzenGridColumn TItem="RubroPatrimonioNetoDto">
                            <Template Context="rubro">
                                <RadzenButton Icon="delete" ButtonStyle="ButtonStyle.Danger" Click="@(() => deleteRubro(rubro))">Eliminar</RadzenButton>
                            </Template>
                        </RadzenGridColumn>
                    </Columns>
                </RadzenGrid>
               

              
               
            </div>

        </div>
    </div>
   







